<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Data da Ocorrência</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
  body {
    font-family: 'Inter', sans-serif;
    background-color: #1a4f8b;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }
  .card {
    background: rgba(255,255,255,0.95);
    max-width: 450px;
    width: 100%;
    padding: 25px;
    border-radius: 16px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.08);
  }
  label { font-weight: 600; margin-top:10px; display:block;}
  input, button { width:100%; padding:10px; margin-top:5px; font-size:1rem; border-radius:8px; }
  button { background:#4a90e2; color:white; border:none; cursor:pointer; }
  #resultado { margin-top:20px; padding:10px; background:#f8faff; border-radius:8px; }
</style>
</head>
<body>
<div class="card">
  <h1>Data da Ocorrência</h1>
  <label for="notificacao">Data da Notificação:</label>
  <input type="date" id="notificacao">
  <label for="prazo">Prazo (dias corridos):</label>
  <input type="number" id="prazo" min="1">
  <button onclick="calcular()">Calcular</button>
  <div id="resultado"></div>
</div>

<script>
let feriados = [];

// Funções utilitárias
const fromInputDate = s => { const [y,m,d]=s.split('-').map(Number); return new Date(y,m-1,d); };
const addDays = (d,n) => { let x = new Date(d.getFullYear(),d.getMonth(),d.getDate()); x.setDate(x.getDate()+n); return x; };
const sameYMD = (a,b) => a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate();
const isWeekend = d => d.getDay()===0||d.getDay()===6;
const ehDiaUtil = d => !isWeekend(d) && !feriados.some(f=>sameYMD(f,d));
const proximoDiaUtil = d => { let x = new Date(d); while(!ehDiaUtil(x)) x = addDays(x,1); return x; };

// Carregar feriados (dd/mm/yyyy)
fetch('Feriados.json').then(r=>r.json()).then(arr=>{
  feriados = arr.map(s=>{ const [d,m,y]=s.split('/').map(Number); return new Date(y,m-1,d); });
}).catch(err=>console.error(err));

function calcular(){
  const out = document.getElementById('resultado');
  const notifVal = document.getElementById('notificacao').value;
  const prazo = parseInt(document.getElementById('prazo').value,10);

  if(!notifVal||isNaN(prazo)||prazo<1){ out.innerHTML='<span style="color:red">Preencha todos os campos corretamente.</span>'; return; }

  // 1️⃣ Ajusta notificação se cair em fim de semana/feriado
  let notifEfetiva = fromInputDate(notifVal);
  notifEfetiva = ehDiaUtil(notifEfetiva)? notifEfetiva : proximoDiaUtil(notifEfetiva);

  // 2️⃣ Início da contagem = dia seguinte à notificação efetiva
  let inicioContagem = addDays(notifEfetiva,1);

  // 3️⃣ Prazo em dias corridos
  let dataFinal = addDays(inicioContagem,prazo-1); // inclui o primeiro dia da contagem

  // 4️⃣ Ajusta dataFinal para próximo dia útil se cair em feriado/fds
  if(!ehDiaUtil(dataFinal)) dataFinal = proximoDiaUtil(dataFinal);

  // 5️⃣ Data da ocorrência = dataFinal + 1 dia (sem ajuste)
  let dataOcorrencia = addDays(dataFinal,1);

  out.innerHTML = `
    <strong>Data de Notificação Efetiva:</strong> ${notifEfetiva.toLocaleDateString('pt-BR')}<br>
    <strong>Início da Contagem:</strong> ${inicioContagem.toLocaleDateString('pt-BR')}<br>
    <strong>Data Final:</strong> ${dataFinal.toLocaleDateString('pt-BR')}<br>
    <strong>Data da Ocorrência:</strong> ${dataOcorrencia.toLocaleDateString('pt-BR')}
  `;
}
</script>
</body>
</html>
