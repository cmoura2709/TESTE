<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Data da OcorrÃªncia</title>
  <style>
    /* ... (mantÃ©m todo o CSS original) ... */
  </style>
</head>
<body>
  <div class="card">
    <h1>Data da OcorrÃªncia</h1>
    <h2>(Recusa de InformaÃ§Ãµes)</h2>

    <label for="notificacao">Data da NotificaÃ§Ã£o:</label>
    <input type="date" id="notificacao">

    <label for="prazo">Prazo (em dias):</label>
    <input type="number" id="prazo" min="1">

    <button onclick="calcular()">Calcular</button>

    <div id="resultado"></div>
  </div>

  <script>
    let feriados = [];

    const fromInputDate = s => {
      const [y, m, d] = s.split('-').map(Number);
      return new Date(y, m - 1, d);
    };

    const parseDataBR = s => {
      const [d, m, y] = s.split('/').map(Number);
      return new Date(y, m - 1, d);
    };

    const sameYMD = (a, b) =>
      a.getFullYear() === b.getFullYear() &&
      a.getMonth() === b.getMonth() &&
      a.getDate() === b.getDate();

    const stripTime = d => new Date(d.getFullYear(), d.getMonth(), d.getDate());

    const addDays = (d, n) => {
      const x = new Date(d.getFullYear(), d.getMonth(), d.getDate());
      x.setDate(x.getDate() + n);
      return x;
    };

    const ehDiaUtil = data => {
      const d = stripTime(data);
      const dow = d.getDay();
      if (dow === 0 || dow === 6) return false;
      return !feriados.some(f => sameYMD(f, d));
    };

    const proximoDiaUtil = data => {
      let d = stripTime(data);
      while (!ehDiaUtil(d)) d = addDays(d, 1);
      return d;
    };

    fetch('Feriados.json')
      .then(r => r.json())
      .then(arr => { feriados = arr.map(parseDataBR); })
      .catch(err => console.error('Erro ao carregar Feriados.json:', err));

    function calcular() {
      const notificacaoVal = document.getElementById('notificacao').value;
      const prazo = parseInt(document.getElementById('prazo').value, 10);
      const out = document.getElementById('resultado');

      if (!notificacaoVal || isNaN(prazo) || prazo < 1) {
        out.innerHTML = `<span style="color:red;">Preencha todos os campos corretamente.</span>`;
        out.style.opacity = 1;
        return;
      }

      // ðŸ”¹ Ajusta notificaÃ§Ã£o para prÃ³ximo dia Ãºtil, se necessÃ¡rio
      let dataNotificacao = fromInputDate(notificacaoVal);
      if (!ehDiaUtil(dataNotificacao)) dataNotificacao = proximoDiaUtil(dataNotificacao);

      // ðŸ”¹ InÃ­cio da contagem = dia seguinte Ã  notificaÃ§Ã£o efetiva (mesmo que nÃ£o seja Ãºtil)
      const inicioContagem = addDays(dataNotificacao, 1);

      // ðŸ”¹ Prazo em dias corridos (incluindo o primeiro dia)
      let dataFinal = addDays(inicioContagem, prazo - 1);

      // ðŸ”¹ Ajusta dataFinal se cair em feriado/fds
      if (!ehDiaUtil(dataFinal)) dataFinal = proximoDiaUtil(dataFinal);

      // ðŸ”¹ Data da ocorrÃªncia = dataFinal + 1 dia (sem ajuste)
      const dataOcorrencia = addDays(dataFinal, 1);

      out.innerHTML = `
        <strong>Data de NotificaÃ§Ã£o Efetiva:</strong> ${dataNotificacao.toLocaleDateString('pt-BR')}<br>
        <strong>Data de InÃ­cio da Contagem:</strong> ${inicioContagem.toLocaleDateString('pt-BR')}<br>
        <strong>Data Final para ApresentaÃ§Ã£o da Resposta:</strong> ${dataFinal.toLocaleDateString('pt-BR')}<br>
        <strong>Data da OcorrÃªncia:</strong> ${dataOcorrencia.toLocaleDateString('pt-BR')}
      `;

      out.style.animation = "none"; // reset animaÃ§Ã£o
      void out.offsetWidth; // reflow
      out.style.animation = "slideUp 0.4s ease forwards";
    }
  </script>
</body>
</html>
